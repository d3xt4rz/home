<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROTINA DA ESPOSA DE IGOR</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #9333ea;
            --primary-hover: #7e22ce;
            --bg-dark: rgba(17, 24, 39, 0.95);
            --border-color: rgba(55, 65, 81, 0.5);
        }
        
        body {
            background: #000 url('https://4kwallpapers.com/images/walls/thumbs_3t/14811.jpg') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 1rem;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e2e8f0;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        @media (max-width: 640px) {
            body {
                padding: 0.5rem;
            }
        }

        .task-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, box-shadow;
            cursor: grab;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .task-item:active {
            cursor: grabbing;
        }

        .task-item.dragging {
            opacity: 0.6;
            transform: rotate(5deg) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .task-item.drag-over {
            border: 2px dashed var(--primary-color);
            background: rgba(147, 51, 234, 0.1);
        }

        .task-item.completed {
            animation: taskComplete 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes taskComplete {
            0% { opacity: 1; transform: translateX(0); }
            50% { opacity: 0.7; transform: translateX(-10px); }
            100% { opacity: 0.5; transform: translateX(0); }
        }

        .glass-card {
            background: var(--bg-dark);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 640px) {
            .glass-card {
                border-radius: 0.75rem !important;
            }
        }

        .btn-primary {
            background-color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .progress-ring {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        input[type="time"]::-webkit-calendar-picker-indicator,
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: var(--bg-dark);
            border-radius: 1rem;
            border: 1px solid var(--border-color);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .sync-indicator {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .drag-handle {
            cursor: grab;
            transition: color 0.2s ease;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .drag-handle:hover {
            color: var(--primary-color);
        }

        .filters-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: #4b5563 #1f2937;
        }

        .filters-container::-webkit-scrollbar {
            height: 6px;
        }

        .filters-container::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 3px;
        }

        .filters-container::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }

        .filters-container::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        .smooth-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .checkbox-custom {
            appearance: none;
            -webkit-appearance: none;
            width: 1.125rem;
            height: 1.125rem;
            border: 2px solid #4b5563;
            border-radius: 0.25rem;
            background: #1f2937;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .checkbox-custom:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .checkbox-custom:checked::before {
            content: 'âœ“';
            position: absolute;
            color: white;
            font-size: 0.75rem;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-custom:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 1px;
        }

        .priority-urgent { background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(185, 28, 28, 0.1)); }
        .priority-high { background: linear-gradient(135deg, rgba(147, 51, 234, 0.2), rgba(126, 34, 206, 0.1)); }
        .priority-medium { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.1)); }
        .priority-low { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.1)); }
        
        .connection-status {
            transition: all 0.3s ease;
        }
        
        .offline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            text-align: center;
            padding: 2rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;
        
        // ConfiguraÃ§Ã£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBMlMkubD980K5ynN5Ud3XEYNWK3Q8RklU",
            authDomain: "db-test-7e79c.firebaseapp.com",
            projectId: "db-test-7e79c",
            storageBucket: "db-test-7e79c.firebasestorage.app",
            messagingSenderId: "472155269675",
            appId: "1:472155269675:web:99df5c6d830927e612586e"
        };

        // InicializaÃ§Ã£o robusta do Firebase
        let app;
        let db;
        let isFirebaseInitialized = false;

        try {
            if (!firebase.apps.length) {
                app = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                // ConfiguraÃ§Ãµes para melhor performance
                db.settings({
                    cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
                });
                
                // Ativar persistÃªncia offline
                db.enablePersistence()
                    .then(() => {
                        console.log("PersistÃªncia offline ativada");
                        isFirebaseInitialized = true;
                    })
                    .catch((err) => {
                        console.warn("PersistÃªncia offline nÃ£o suportada:", err);
                        isFirebaseInitialized = true;
                    });
                
                console.log("Firebase inicializado com sucesso!");
            } else {
                app = firebase.apps[0];
                db = firebase.firestore(app);
                isFirebaseInitialized = true;
            }
        } catch (error) {
            console.error("Erro crÃ­tico ao inicializar Firebase:", error);
            isFirebaseInitialized = false;
        }

        // JSON padrÃ£o para frases de elogio
        const defaultPhrases = {
            "completionTexts": [
                "Bom progresso! 3x mais gostosaaa ðŸ”¥",
                "Ainn continue assim bb! ðŸ’ª",
                "Ainn continue ðŸ”¥",
            ]
        };

        // API do Firestore - VersÃ£o Corrigida e Otimizada
        const FirestoreTasksAPI = {
            isInitialized: () => isFirebaseInitialized && db,
            
            getTasksCollection: () => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o inicializado");
                }
                return db.collection('tasks');
            },
            
            getPhrasesCollection: () => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o inicializado");
                }
                return db.collection('phrases');
            },
            
            getCurrentUserId: () => {
                let userId = localStorage.getItem('dailyTasks_userId');
                if (!userId) {
                    userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    localStorage.setItem('dailyTasks_userId', userId);
                }
                return userId;
            },
            
            // Verificar conexÃ£o com Firebase
            checkConnection: async () => {
                if (!FirestoreTasksAPI.isInitialized()) return false;
                
                try {
                    await db.collection('tasks').limit(1).get({ source: 'server' });
                    return true;
                } catch (error) {
                    console.warn("Firebase offline:", error);
                    return false;
                }
            },
            
            // Obter tasks do Firestore
            getTasks: async () => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o disponÃ­vel");
                }
                
                try {
                    const userId = FirestoreTasksAPI.getCurrentUserId();
                    const snapshot = await FirestoreTasksAPI.getTasksCollection()
                        .where('userId', '==', userId)
                        .orderBy('order', 'asc')
                        .get();
                    
                    return snapshot.docs.map(doc => {
                        const data = doc.data();
                        return {
                            id: doc.id,
                            ...data,
                            createdAt: data.createdAt?.toDate?.() || new Date(),
                            updatedAt: data.updatedAt?.toDate?.() || new Date()
                        };
                    });
                } catch (error) {
                    console.error("Erro ao buscar tarefas:", error);
                    throw error;
                }
            },
            
            // Obter frases do Firestore
            getPhrases: async () => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    return defaultPhrases;
                }
                
                try {
                    const phrasesDoc = await FirestoreTasksAPI.getPhrasesCollection().doc('default').get();
                    if (phrasesDoc.exists) {
                        return phrasesDoc.data();
                    }
                    return defaultPhrases;
                } catch (error) {
                    console.error("Erro ao buscar frases:", error);
                    return defaultPhrases;
                }
            },
            
            // Adicionar nova task
            addTask: async (task) => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o disponÃ­vel");
                }
                
                try {
                    const userId = FirestoreTasksAPI.getCurrentUserId();
                    const tasksSnapshot = await FirestoreTasksAPI.getTasksCollection()
                        .where('userId', '==', userId)
                        .get();
                    
                    const maxOrder = tasksSnapshot.empty ? 0 : 
                        Math.max(...tasksSnapshot.docs.map(doc => doc.data().order || 0));
                    
                    const newTask = {
                        title: task.title.trim(),
                        dueDate: task.dueDate || null,
                        dueTime: task.dueTime || null,
                        done: false,
                        order: maxOrder + 1,
                        userId: userId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    const docRef = await FirestoreTasksAPI.getTasksCollection().add(newTask);
                    return { 
                        id: docRef.id, 
                        ...newTask,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    };
                } catch (error) {
                    console.error("Erro ao adicionar tarefa:", error);
                    throw error;
                }
            },
            
            // Atualizar task existente
            updateTask: async (id, updates) => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o disponÃ­vel");
                }
                
                try {
                    const taskRef = FirestoreTasksAPI.getTasksCollection().doc(id);
                    const taskDoc = await taskRef.get();
                    
                    if (!taskDoc.exists) return null;
                    
                    await taskRef.update({
                        ...updates,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    const updatedData = { ...taskDoc.data(), ...updates };
                    return {
                        id: taskDoc.id,
                        ...updatedData,
                        createdAt: updatedData.createdAt?.toDate?.() || new Date(),
                        updatedAt: new Date()
                    };
                } catch (error) {
                    console.error("Erro ao atualizar tarefa:", error);
                    throw error;
                }
            },
            
            // Deletar task
            deleteTask: async (id) => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o disponÃ­vel");
                }
                
                try {
                    const taskRef = FirestoreTasksAPI.getTasksCollection().doc(id);
                    await taskRef.delete();
                    return true;
                } catch (error) {
                    console.error("Erro ao deletar tarefa:", error);
                    throw error;
                }
            },
            
            // Limpar tasks concluÃ­das
            clearCompleted: async () => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o disponÃ­vel");
                }
                
                try {
                    const userId = FirestoreTasksAPI.getCurrentUserId();
                    const snapshot = await FirestoreTasksAPI.getTasksCollection()
                        .where('userId', '==', userId)
                        .where('done', '==', true)
                        .get();
                    
                    const batch = db.batch();
                    snapshot.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    await batch.commit();
                    return true;
                } catch (error) {
                    console.error("Erro ao limpar tarefas concluÃ­das:", error);
                    throw error;
                }
            },
            
            // Reordenar tasks
            reorderTasks: async (reorderedTasks) => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o disponÃ­vel");
                }
                
                try {
                    const batch = db.batch();
                    
                    reorderedTasks.forEach((task, index) => {
                        const taskRef = FirestoreTasksAPI.getTasksCollection().doc(task.id);
                        batch.update(taskRef, {
                            order: index,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                    
                    await batch.commit();
                    return true;
                } catch (error) {
                    console.error("Erro ao reordenar tarefas:", error);
                    throw error;
                }
            },
            
            // Salvar frases
            savePhrases: async (phrasesData) => {
                if (!FirestoreTasksAPI.isInitialized()) {
                    throw new Error("Firebase nÃ£o disponÃ­vel");
                }
                
                try {
                    await FirestoreTasksAPI.getPhrasesCollection().doc('default').set(phrasesData);
                    return true;
                } catch (error) {
                    console.error("Erro ao salvar frases:", error);
                    throw error;
                }
            },
            
            // Inicializar dados padrÃ£o
            initializeDefaultData: async () => {
                if (!FirestoreTasksAPI.isInitialized()) return;
                
                try {
                    const phrasesDoc = await FirestoreTasksAPI.getPhrasesCollection().doc('default').get();
                    if (!phrasesDoc.exists) {
                        await FirestoreTasksAPI.getPhrasesCollection().doc('default').set(defaultPhrases);
                        console.log("Frases padrÃ£o inicializadas no Firestore");
                    }
                } catch (error) {
                    console.error("Erro ao inicializar dados padrÃ£o:", error);
                }
            }
        };

        // Componente de Tarefa Individual para melhor performance
        const TaskItem = React.memo(({ 
            task, 
            index, 
            toggleDone, 
            startEdit, 
            removeTask, 
            isLoading,
            isConnected,
            draggedTask,
            dragOverTask,
            onDragStart,
            onDragOver,
            onDragLeave,
            onDrop,
            onDragEnd
        }) => {
            const priority = useMemo(() => getTaskPriority(task), [task]);
            const badge = useMemo(() => getPriorityBadge(priority), [priority]);
            const isOverdue = priority === "urgent" && !task.done;
            const isDragging = draggedTask && draggedTask.id === task.id;
            const isDragOver = dragOverTask && dragOverTask.id === task.id;
            
            const handleDragStart = useCallback((e) => {
                onDragStart(e, task);
            }, [task, onDragStart]);

            const handleDragOver = useCallback((e) => {
                onDragOver(e, task);
            }, [task, onDragOver]);

            const handleDrop = useCallback((e) => {
                onDrop(e, task);
            }, [task, onDrop]);

            return (
                <div
                    draggable={!isLoading && isConnected}
                    onDragStart={handleDragStart}
                    onDragOver={handleDragOver}
                    onDragLeave={onDragLeave}
                    onDrop={handleDrop}
                    onDragEnd={onDragEnd}
                    className={`task-item smooth-transition ${
                        task.done ? 'completed' : ''
                    } ${isDragging ? 'dragging' : ''} ${
                        isDragOver ? 'drag-over' : ''
                    } glass-card rounded-lg p-3.5 border ${
                        isOverdue ? 'border-red-700/50 priority-urgent' : 
                        task.done ? 'border-green-700/30' : 
                        'border-gray-700'
                    } ${isLoading || !isConnected ? 'opacity-50' : ''}`}
                >
                    <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                        <div className="flex items-start gap-3 flex-1">
                            <div className="mt-0.5 flex-shrink-0">
                                <input
                                    type="checkbox"
                                    checked={task.done}
                                    onChange={() => toggleDone(task.id)}
                                    disabled={isLoading || !isConnected}
                                    className="checkbox-custom"
                                    aria-label={`Marcar ${task.title} como ${task.done ? 'pendente' : 'concluÃ­da'}`}
                                />
                            </div>
                            
                            <div className="flex-1 min-w-0">
                                <div className={`text-sm font-medium smooth-transition ${
                                    task.done ? "line-through text-gray-500" : "text-gray-200"
                                }`}>
                                    {task.title}
                                </div>
                                <div className="flex flex-wrap items-center gap-2 mt-1">
                                    <span className={`text-xs px-2 py-0.5 rounded-full border ${badge.color}`}>
                                        <i className="fas fa-clock mr-0.5 text-[0.75em]"></i>
                                        {badge.text}
                                    </span>
                                    {task.dueDate && (
                                        <span className="text-xs text-gray-500">
                                            <i className="far fa-calendar mr-0.5 text-[0.75em]"></i>
                                            {formatDate(task.dueDate)}
                                        </span>
                                    )}
                                    {task.dueTime && (
                                        <span className="text-xs text-gray-500">
                                            <i className="far fa-clock mr-0.5 text-[0.75em]"></i>
                                            {task.dueTime}
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                        
                        <div className="flex flex-wrap gap-1.5 justify-end">
                            <div 
                                className="drag-handle text-gray-400 p-1.5 cursor-grab rounded-md hover:bg-gray-800 smooth-transition" 
                                title="Arrastar para reordenar"
                                aria-label="Arrastar para reordenar"
                            >
                                <i className="fas fa-grip-vertical"></i>
                            </div>
                            <button 
                                onClick={() => startEdit(task)} 
                                disabled={isLoading || !isConnected}
                                className="p-1.5 rounded-md text-gray-400 hover:text-purple-400 hover:bg-purple-900/30 smooth-transition disabled:opacity-50 disabled:cursor-not-allowed"
                                title="Editar tarefa"
                                aria-label={`Editar tarefa: ${task.title}`}
                            >
                                <i className="fas fa-edit text-sm"></i>
                            </button>
                            <button 
                                onClick={() => removeTask(task.id)} 
                                disabled={isLoading || !isConnected}
                                className="p-1.5 rounded-md text-gray-400 hover:text-red-400 hover:bg-red-900/30 smooth-transition disabled:opacity-50 disabled:cursor-not-allowed"
                                title="Excluir tarefa"
                                aria-label={`Excluir tarefa: ${task.title}`}
                            >
                                <i className="fas fa-trash-alt text-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        });

        function DailyTasksApp() {
            const [showWelcome, setShowWelcome] = useState(() => {
                const welcomeShown = localStorage.getItem("dailyTasks_welcomeShown");
                return welcomeShown !== "true";
            });
            const [tasks, setTasks] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isConnected, setIsConnected] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            const [phrases, setPhrases] = useState(defaultPhrases);
            const [title, setTitle] = useState("");
            const [dueDate, setDueDate] = useState("");
            const [dueTime, setDueTime] = useState("");
            const [editingId, setEditingId] = useState(null);
            const [filter, setFilter] = useState("all");
            const [search, setSearch] = useState("");
            const [stats, setStats] = useState({ total: 0, completed: 0, pending: 0, completionRate: 0 });
            const [showPhrasesModal, setShowPhrasesModal] = useState(false);
            const [newPhrase, setNewPhrase] = useState("");
            const [draggedTask, setDraggedTask] = useState(null);
            const [dragOverTask, setDragOverTask] = useState(null);
            const [isReconnecting, setIsReconnecting] = useState(false);
            
            const tasksUnsubscribeRef = useRef(null);
            const phrasesUnsubscribeRef = useRef(null);
            const isMountedRef = useRef(true);
            const connectionCheckRef = useRef(null);

            // VerificaÃ§Ã£o de conexÃ£o melhorada
            useEffect(() => {
                const checkFirebaseConnection = async () => {
                    try {
                        const connected = await FirestoreTasksAPI.checkConnection();
                        if (isMountedRef.current) {
                            setIsConnected(connected);
                            if (connected) {
                                setLastSync(new Date());
                            }
                        }
                    } catch (error) {
                        if (isMountedRef.current) {
                            setIsConnected(false);
                        }
                    }
                };

                // Verificar conexÃ£o periodicamente
                connectionCheckRef.current = setInterval(checkFirebaseConnection, 30000);
                
                // Verificar tambÃ©m quando o navegador fica online
                const handleOnline = () => {
                    setTimeout(checkFirebaseConnection, 1000);
                };
                
                window.addEventListener('online', handleOnline);
                
                return () => {
                    clearInterval(connectionCheckRef.current);
                    window.removeEventListener('online', handleOnline);
                };
            }, []);

            // InicializaÃ§Ã£o corrigida - sem loop
            useEffect(() => {
                const initApp = async () => {
                    if (!FirestoreTasksAPI.isInitialized()) {
                        console.error("Firebase nÃ£o inicializado");
                        if (isMountedRef.current) {
                            setIsLoading(false);
                            setIsConnected(false);
                        }
                        return;
                    }
                    
                    try {
                        setIsLoading(true);
                        
                        // Inicializar dados padrÃ£o
                        await FirestoreTasksAPI.initializeDefaultData();
                        
                        // Carregar dados iniciais
                        const [initialTasks, initialPhrases] = await Promise.all([
                            FirestoreTasksAPI.getTasks(),
                            FirestoreTasksAPI.getPhrases()
                        ]);
                        
                        if (isMountedRef.current) {
                            setTasks(initialTasks);
                            setPhrases(initialPhrases);
                            setLastSync(new Date());
                            
                            // Verificar conexÃ£o apÃ³s carregamento inicial
                            const connected = await FirestoreTasksAPI.checkConnection();
                            setIsConnected(connected);
                        }
                        
                    } catch (error) {
                        console.error("Erro ao inicializar app:", error);
                        if (isMountedRef.current) {
                            setIsConnected(false);
                        }
                    } finally {
                        if (isMountedRef.current) {
                            setIsLoading(false);
                        }
                    }
                };
                
                initApp();
                
                return () => {
                    isMountedRef.current = false;
                };
            }, []);

            // Setup de listeners separado - apenas quando conectado
            useEffect(() => {
                if (!isConnected || !FirestoreTasksAPI.isInitialized()) return;
                
                const setupListeners = () => {
                    const userId = FirestoreTasksAPI.getCurrentUserId();
                    
                    // Listener para tasks
                    tasksUnsubscribeRef.current = FirestoreTasksAPI.getTasksCollection()
                        .where('userId', '==', userId)
                        .orderBy('order', 'asc')
                        .onSnapshot(
                            (snapshot) => {
                                const tasksData = snapshot.docs.map(doc => {
                                    const data = doc.data();
                                    return {
                                        id: doc.id,
                                        ...data,
                                        createdAt: data.createdAt?.toDate?.() || new Date(),
                                        updatedAt: data.updatedAt?.toDate?.() || new Date()
                                    };
                                });
                                
                                if (isMountedRef.current) {
                                    setTasks(tasksData);
                                    setLastSync(new Date());
                                }
                            },
                            (error) => {
                                console.error("Erro no listener de tasks:", error);
                                if (isMountedRef.current) {
                                    setIsConnected(false);
                                }
                            }
                        );
                    
                    // Listener para frases
                    phrasesUnsubscribeRef.current = FirestoreTasksAPI.getPhrasesCollection()
                        .doc('default')
                        .onSnapshot(
                            (snapshot) => {
                                if (snapshot.exists && isMountedRef.current) {
                                    setPhrases(snapshot.data());
                                }
                            },
                            (error) => {
                                console.error("Erro no listener de frases:", error);
                            }
                        );
                };
                
                setupListeners();
                
                return () => {
                    if (tasksUnsubscribeRef.current) tasksUnsubscribeRef.current();
                    if (phrasesUnsubscribeRef.current) phrasesUnsubscribeRef.current();
                };
            }, [isConnected]);

            // Calcular estatÃ­sticas
            useEffect(() => {
                const calculateStats = () => {
                    const now = new Date();
                    
                    const completed = tasks.filter(t => t.done).length;
                    const pending = tasks.filter(t => {
                        if (t.done) return false;
                        if (t.dueDate) {
                            const taskDate = createDate(t.dueDate, t.dueTime);
                            return taskDate && taskDate < now;
                        }
                        return false;
                    }).length;
                    
                    const completionRate = tasks.length > 0 ? Math.round((completed / tasks.length) * 100) : 0;
                    
                    setStats({
                        total: tasks.length,
                        completed,
                        pending,
                        completionRate
                    });
                };

                calculateStats();
            }, [tasks]);

            useEffect(() => {
                if (tasks.length > 0) {
                    setShowWelcome(false);
                }
            }, [tasks]);

            // FunÃ§Ã£o auxiliar para criar data
            const createDate = useCallback((dateString, timeString = null) => {
                if (!dateString) return null;
                
                const [year, month, day] = dateString.split('-').map(Number);
                let date = new Date(year, month - 1, day);
                
                if (timeString) {
                    const [hours, minutes] = timeString.split(':').map(Number);
                    date.setHours(hours, minutes, 0, 0);
                } else {
                    date.setHours(23, 59, 0, 0);
                }
                
                return date;
            }, []);

            // FunÃ§Ã£o de reconexÃ£o melhorada
            const reconnect = useCallback(async () => {
                if (!FirestoreTasksAPI.isInitialized()) return;
                
                try {
                    setIsReconnecting(true);
                    const connected = await FirestoreTasksAPI.checkConnection();
                    
                    if (connected && isMountedRef.current) {
                        setIsConnected(true);
                        // Recarregar dados manualmente apÃ³s reconexÃ£o
                        const freshTasks = await FirestoreTasksAPI.getTasks();
                        const freshPhrases = await FirestoreTasksAPI.getPhrases();
                        
                        if (isMountedRef.current) {
                            setTasks(freshTasks);
                            setPhrases(freshPhrases);
                            setLastSync(new Date());
                        }
                    }
                } catch (error) {
                    console.error("Falha na reconexÃ£o:", error);
                } finally {
                    if (isMountedRef.current) {
                        setIsReconnecting(false);
                    }
                }
            }, []);

            const addOrUpdateTask = useCallback(async (e) => {
                e.preventDefault();
                if (!title.trim() || !isConnected) return;

                setIsLoading(true);
                try {
                    if (editingId) {
                        // Atualizar tarefa existente
                        await FirestoreTasksAPI.updateTask(editingId, {
                            title: title.trim(),
                            dueDate: dueDate || null,
                            dueTime: dueTime || null
                        });
                        
                        if (isMountedRef.current) {
                            setEditingId(null);
                        }
                    } else {
                        // Adicionar nova tarefa
                        const newTask = {
                            title: title.trim(),
                            dueDate: dueDate || null,
                            dueTime: dueTime || null,
                            done: false,
                        };
                        await FirestoreTasksAPI.addTask(newTask);
                    }
                    
                    if (isMountedRef.current) {
                        setTitle("");
                        setDueDate("");
                        setDueTime("");
                    }
                } catch (error) {
                    console.error("Erro ao salvar tarefa:", error);
                    alert("Erro ao salvar tarefa. Tente novamente.");
                } finally {
                    if (isMountedRef.current) {
                        setIsLoading(false);
                    }
                }
            }, [title, dueDate, dueTime, editingId, isConnected]);
            
            const toggleDone = useCallback(async (id) => {
                if (!isConnected) return;
                
                try {
                    const task = tasks.find(t => t.id === id);
                    if (task) {
                        await FirestoreTasksAPI.updateTask(id, { done: !task.done });
                    }
                } catch (error) {
                    console.error("Erro ao atualizar status da tarefa:", error);
                    alert("Erro ao atualizar tarefa. Verifique sua conexÃ£o.");
                }
            }, [tasks, isConnected]);
            
            const startEdit = useCallback((t) => {
                setEditingId(t.id);
                setTitle(t.title);
                setDueDate(t.dueDate || "");
                setDueTime(t.dueTime || "");
            }, []);
            
            const removeTask = useCallback(async (id) => {
                if (!isConnected || !confirm("Tem certeza que deseja excluir esta tarefa?")) return;
                
                try {
                    await FirestoreTasksAPI.deleteTask(id);
                } catch (error) {
                    console.error("Erro ao excluir tarefa:", error);
                    alert("Erro ao excluir tarefa. Tente novamente.");
                }
            }, [isConnected]);
            
            const clearCompleted = useCallback(async () => {
                if (!isConnected || !confirm("Remover todas as tarefas concluÃ­das?")) return;
                
                try {
                    await FirestoreTasksAPI.clearCompleted();
                } catch (error) {
                    console.error("Erro ao limpar tarefas concluÃ­das:", error);
                    alert("Erro ao limpar tarefas concluÃ­das. Tente novamente.");
                }
            }, [isConnected]);
            
            const refreshTasks = useCallback(async () => {
                if (!isConnected) return;
                
                setIsLoading(true);
                try {
                    const freshTasks = await FirestoreTasksAPI.getTasks();
                    if (isMountedRef.current) {
                        setTasks(freshTasks);
                        setLastSync(new Date());
                    }
                } catch (error) {
                    console.error("Erro ao atualizar tarefas:", error);
                } finally {
                    if (isMountedRef.current) {
                        setIsLoading(false);
                    }
                }
            }, [isConnected]);
            
            // FunÃ§Ãµes para Drag and Drop
            const handleDragStart = useCallback((e, task) => {
                setDraggedTask(task);
                e.dataTransfer.effectAllowed = 'move';
                setTimeout(() => {
                    e.target.classList.add('dragging');
                }, 0);
            }, []);
            
            const handleDragOver = useCallback((e, task) => {
                e.preventDefault();
                if (draggedTask && draggedTask.id !== task.id) {
                    setDragOverTask(task);
                }
            }, [draggedTask]);
            
            const handleDragLeave = useCallback((e) => {
                e.preventDefault();
                setDragOverTask(null);
            }, []);
            
            const handleDrop = useCallback(async (e, targetTask) => {
                e.preventDefault();
                if (!isConnected || !draggedTask || draggedTask.id === targetTask.id) {
                    setDraggedTask(null);
                    setDragOverTask(null);
                    return;
                }
                
                try {
                    const taskList = [...tasks];
                    const draggedIndex = taskList.findIndex(t => t.id === draggedTask.id);
                    const targetIndex = taskList.findIndex(t => t.id === targetTask.id);
                    
                    if (draggedIndex !== -1 && targetIndex !== -1) {
                        const [movedTask] = taskList.splice(draggedIndex, 1);
                        taskList.splice(targetIndex, 0, movedTask);
                        
                        setIsLoading(true);
                        await FirestoreTasksAPI.reorderTasks(taskList);
                    }
                } catch (error) {
                    console.error("Erro ao reordenar tarefas:", error);
                    alert("Erro ao reordenar tarefas. Tente novamente.");
                } finally {
                    setDraggedTask(null);
                    setDragOverTask(null);
                    setIsLoading(false);
                }
            }, [draggedTask, tasks, isConnected]);
            
            const handleDragEnd = useCallback((e) => {
                e.target.classList.remove('dragging');
                setDraggedTask(null);
                setDragOverTask(null);
            }, []);
            
            const getTaskPriority = useCallback((task) => {
                if (task.done) return "none";
                if (!task.dueDate) return "none";
                
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const taskDate = createDate(task.dueDate);
                if (!taskDate) return "none";
                
                const taskDateOnly = new Date(taskDate.getFullYear(), taskDate.getMonth(), taskDate.getDate());
                
                if (taskDateOnly.getTime() === today.getTime()) {
                    if (task.dueTime) {
                        return taskDate < now ? "urgent" : "high";
                    }
                    return "high";
                }
                
                if (taskDateOnly < today) return "urgent";
                
                if (taskDateOnly.getTime() === tomorrow.getTime()) return "medium";
                
                const dayAfterTomorrow = new Date(tomorrow);
                dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 1);
                const inThreeDays = new Date(tomorrow);
                inThreeDays.setDate(inThreeDays.getDate() + 2);
                
                if (taskDateOnly >= dayAfterTomorrow && taskDateOnly <= inThreeDays) return "medium";
                
                return "low";
            }, [createDate]);
            
            const getPriorityBadge = useCallback((priority) => {
                const badges = {
                    urgent: { text: "Atrasado", color: "bg-red-900 text-red-300 border-red-700" },
                    high: { text: "Hoje", color: "bg-purple-900 text-purple-200 border-purple-700" },
                    medium: { text: "Em breve", color: "bg-amber-900 text-amber-200 border-amber-700" },
                    low: { text: "Futuro", color: "bg-emerald-900 text-emerald-200 border-emerald-700" },
                    none: { text: "Sem data", color: "bg-gray-800 text-gray-300 border-gray-700" }
                };
                return badges[priority];
            }, []);
            
            const formatDate = useCallback((dateString) => {
                if (!dateString) return '';
                
                const date = createDate(dateString);
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const tomorrowOnly = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate());
                
                if (dateOnly.getTime() === todayOnly.getTime()) {
                    return 'Hoje';
                } else if (dateOnly.getTime() === tomorrowOnly.getTime()) {
                    return 'AmanhÃ£';
                } else {
                    return date.toLocaleDateString('pt-BR', { 
                        day: '2-digit', 
                        month: '2-digit', 
                        year: 'numeric' 
                    });
                }
            }, [createDate]);
            
            const getCompletionText = useCallback(() => {
                if (stats.completionRate === 100 && phrases.completionTexts.length > 0) {
                    return phrases.completionTexts[0];
                }
                if (stats.completionRate >= 80 && phrases.completionTexts.length > 1) {
                    return phrases.completionTexts[1];
                }
                if (stats.completionRate >= 60 && phrases.completionTexts.length > 2) {
                    return phrases.completionTexts[2];
                }
                if (stats.completionRate >= 40 && phrases.completionTexts.length > 3) {
                    return phrases.completionTexts[3];
                }
                if (phrases.completionTexts.length > 4) {
                    return phrases.completionTexts[4];
                }
                return "Continue assim!";
            }, [stats.completionRate, phrases.completionTexts]);
            
            const handleStart = useCallback(() => {
                setShowWelcome(false);
                localStorage.setItem("dailyTasks_welcomeShown", "true");
            }, []);
            
            // FunÃ§Ãµes para gerenciar frases
            const addPhrase = useCallback(async () => {
                if (!newPhrase.trim() || !isConnected) return;
                
                try {
                    const updatedPhrases = {
                        ...phrases,
                        completionTexts: [...phrases.completionTexts, newPhrase.trim()]
                    };
                    await FirestoreTasksAPI.savePhrases(updatedPhrases);
                    setNewPhrase("");
                } catch (error) {
                    console.error("Erro ao adicionar frase:", error);
                    alert("Erro ao adicionar frase. Tente novamente.");
                }
            }, [newPhrase, isConnected, phrases]);
            
            const removePhrase = useCallback(async (index) => {
                if (!isConnected || !confirm("Tem certeza que deseja remover esta frase?")) return;
                
                try {
                    const updatedPhrases = {
                        ...phrases,
                        completionTexts: phrases.completionTexts.filter((_, i) => i !== index)
                    };
                    await FirestoreTasksAPI.savePhrases(updatedPhrases);
                } catch (error) {
                    console.error("Erro ao remover frase:", error);
                    alert("Erro ao remover frase. Tente novamente.");
                }
            }, [isConnected, phrases]);
            
            const resetPhrases = useCallback(async () => {
                if (!isConnected || !confirm("Isso restaurarÃ¡ as frases padrÃ£o. Tem certeza?")) return;
                
                try {
                    await FirestoreTasksAPI.savePhrases(defaultPhrases);
                } catch (error) {
                    console.error("Erro ao resetar frases:", error);
                    alert("Erro ao resetar frases. Tente novamente.");
                }
            }, [isConnected]);

            const visibleTasks = useMemo(() => {
                return tasks.filter((t) => {
                    if (search && !t.title.toLowerCase().includes(search.toLowerCase())) return false;

                    if (filter === "all") return true;
                    if (filter === "completed") return t.done;
                    if (filter === "pending") return !t.done;
                    if (filter === "overdue") {
                        if (t.done || !t.dueDate) return false;
                        const now = new Date();
                        const taskDate = createDate(t.dueDate, t.dueTime);
                        return taskDate && taskDate < now;
                    }
                    if (filter === "today") {
                        if (t.done || !t.dueDate) return false;
                        const today = new Date();
                        const taskDate = createDate(t.dueDate);
                        const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                        const taskDateOnly = new Date(taskDate.getFullYear(), taskDate.getMonth(), taskDate.getDate());
                        return taskDateOnly.getTime() === todayOnly.getTime();
                    }
                    return true;
                });
            }, [tasks, search, filter, createDate]);

            // Efeito para focar no input de tÃ­tulo quando editar
            useEffect(() => {
                if (editingId) {
                    const titleInput = document.querySelector('input[placeholder*="Editar tarefa"]');
                    if (titleInput) {
                        titleInput.focus();
                    }
                }
            }, [editingId]);

            // RenderizaÃ§Ã£o do status de conexÃ£o
            const renderConnectionStatus = () => (
                <div className="flex items-center gap-3">
                    <div className="flex items-center gap-1 bg-gray-800 px-2 py-1 rounded-lg">
                        <i className="fas fa-check-circle text-green-400"></i>
                        <span className="font-medium text-gray-200">{stats.completed}/{stats.total}</span>
                    </div>
                    <div className="w-1 h-1 rounded-full bg-gray-600"></div>
                    <div className="flex items-center gap-1 bg-gray-800 px-2 py-1 rounded-lg">
                        <i className="fas fa-exclamation-circle text-red-400"></i>
                        <span className="font-medium text-red-300">{stats.pending}</span>
                    </div>
                    <div className="flex items-center gap-1">
                        <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium connection-status ${
                            isConnected ? 'bg-green-900/30 text-green-400' : 'bg-red-900/30 text-red-400'
                        }`}>
                            <span className={`w-1.5 h-1.5 rounded-full mr-1 ${
                                isConnected ? 'bg-green-400' : 'bg-red-400'
                            }`}></span>
                            {isConnected ? 'Online' : 'Offline'}
                        </span>
                        {!isConnected && (
                            <button
                                onClick={reconnect}
                                disabled={isReconnecting}
                                className="px-2 py-0.5 rounded-lg text-xs bg-blue-600 hover:bg-blue-700 text-white smooth-transition disabled:opacity-50"
                                title="Tentar reconectar"
                            >
                                <i className={`fas fa-sync-alt mr-1 ${isReconnecting ? 'fa-spin' : ''}`}></i>
                                {isReconnecting ? 'Conectando...' : 'Reconectar'}
                            </button>
                        )}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    {/* Overlay de offline */}
                    {!isConnected && !isReconnecting && (
                        <div className="offline-overlay">
                            <div className="glass-card p-6 rounded-2xl text-center max-w-md">
                                <div className="text-5xl mb-3 text-red-400">
                                    <i className="fas fa-wifi"></i>
                                </div>
                                <h3 className="text-xl font-bold mb-2 text-red-300">
                                    Sem ConexÃ£o
                                </h3>
                                <p className="text-gray-300 mb-4">
                                    NÃ£o foi possÃ­vel conectar ao banco de dados. Verifique sua conexÃ£o com a internet.
                                </p>
                                <button
                                    onClick={reconnect}
                                    className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg smooth-transition"
                                >
                                    <i className="fas fa-sync-alt mr-2"></i>
                                    Tentar Reconectar
                                </button>
                            </div>
                        </div>
                    )}
                    
                    {showWelcome && (
                        <div className="glass-card rounded-2xl p-6 mb-6 text-center animate-fade-in-up border border-gray-700 w-full max-w-md">
                            <div className="flex justify-center mb-4">
                                <div className="w-14 h-14 rounded-lg bg-gradient-to-br from-purple-600 to-purple-800 flex items-center justify-center">
                                    <i className="fas fa-tasks text-white text-xl"></i>
                                </div>
                            </div>
                            <h2 className="text-xl md:text-2xl font-bold mb-3 text-gray-200">
                                Bem-vindo delicia, vamo querer se organizar?
                            </h2>
                            <p className="text-gray-400 mb-5 max-w-md mx-auto text-sm">
                                Organize sua rotina ai, acompanhe seu progresso e conquiste seus objetivos diÃ¡rios com facilidade. hehehe.
                            </p>
                            <button 
                                onClick={handleStart}
                                className="px-5 py-2.5 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-medium rounded-lg smooth-transition shadow-md transform hover:scale-105"
                            >
                                ComeÃ§ar Agora
                            </button>
                        </div>
                    )}
                    
                    <div className="w-full max-w-4xl">
                        <div className={`glass-card rounded-2xl shadow-lg overflow-hidden border border-gray-700 ${showWelcome ? 'hidden' : 'block'}`}>
                            {/* CabeÃ§alho com estatÃ­sticas */}
                            <div className="p-5 border-b border-gray-700">
                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                                    {renderConnectionStatus()}
                                    
                                    <div className="flex gap-2">
                                        <button
                                            onClick={refreshTasks}
                                            disabled={!isConnected || isLoading}
                                            className="px-3 py-1.5 rounded-lg text-gray-300 hover:text-blue-300 hover:bg-blue-900/30 border border-blue-700/50 smooth-transition flex items-center gap-1.5 text-sm disabled:opacity-50"
                                            title="Atualizar tarefas"
                                            aria-label="Atualizar tarefas"
                                        >
                                            <i className="fas fa-sync-alt" style={{fontSize: '0.85em'}}></i>
                                            <span className="hidden sm:inline">Atualizar</span>
                                        </button>
                                        
                                        <button
                                            onClick={() => setShowPhrasesModal(true)}
                                            disabled={isLoading}
                                            className="px-3 py-1.5 rounded-lg text-gray-300 hover:text-purple-300 hover:bg-purple-900/30 border border-purple-700/50 smooth-transition flex items-center gap-1.5 text-sm disabled:opacity-50"
                                            aria-label="Gerenciar frases de elogio"
                                        >
                                            <i className="fas fa-comment-alt" style={{fontSize: '0.85em'}}></i>
                                            <span className="hidden sm:inline">Frases</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* FormulÃ¡rio de adiÃ§Ã£o/ediÃ§Ã£o */}
                            <div className="p-5 border-b border-gray-700">
                                <form onSubmit={addOrUpdateTask} className="relative">
                                    <div className="flex flex-col gap-3">
                                        <div className="flex flex-col sm:flex-row gap-3">
                                            <div className="flex-1">
                                                <div className="relative">
                                                    <div className="absolute left-3.5 top-1/2 -translate-y-1/2 text-purple-400">
                                                        <i className={editingId ? "fas fa-edit" : "fas fa-plus"}></i>
                                                    </div>
                                                    <input
                                                        value={title}
                                                        onChange={(e) => setTitle(e.target.value)}
                                                        placeholder={editingId ? "Editar tarefa..." : "O que vocÃª precisa fazer hoje?"}
                                                        className="w-full pl-10 pr-4 py-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent smooth-transition text-white placeholder-gray-500"
                                                        disabled={isLoading || !isConnected}
                                                        aria-label={editingId ? "Editar tarefa" : "Nova tarefa"}
                                                    />
                                                </div>
                                            </div>
                                            
                                            <div className="flex flex-col sm:flex-row gap-3">
                                                <button
                                                    type="submit"
                                                    disabled={isLoading || !isConnected || !title.trim()}
                                                    className="px-4 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-medium shadow-md smooth-transition flex items-center justify-center min-w-[110px] disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 disabled:hover:scale-100"
                                                >
                                                    <span className="flex items-center gap-1.5">
                                                        {isLoading ? (
                                                            <i className="fas fa-spinner fa-spin"></i>
                                                        ) : editingId ? (
                                                            <>
                                                                <i className="fas fa-save"></i>
                                                                <span className="hidden sm:inline text-sm">Salvar</span>
                                                            </>
                                                        ) : (
                                                            <>
                                                                <i className="fas fa-plus"></i>
                                                                <span className="hidden sm:inline text-sm">Adicionar</span>
                                                            </>
                                                        )}
                                                    </span>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div className="flex flex-col sm:flex-row gap-3">
                                            <div className="relative flex-1">
                                                <div className="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400">
                                                    <i className="far fa-calendar"></i>
                                                </div>
                                                <input
                                                    type="date"
                                                    value={dueDate}
                                                    onChange={(e) => setDueDate(e.target.value)}
                                                    className="w-full pl-10 pr-4 py-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent smooth-transition"
                                                    disabled={isLoading || !isConnected}
                                                    aria-label="Data de vencimento"
                                                />
                                            </div>
                                            
                                            <div className="relative flex-1">
                                                <div className="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400">
                                                    <i className="far fa-clock"></i>
                                                </div>
                                                <input
                                                    type="time"
                                                    value={dueTime}
                                                    onChange={(e) => setDueTime(e.target.value)}
                                                    className="w-full pl-10 pr-4 py-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent smooth-transition"
                                                    disabled={isLoading || !isConnected}
                                                    aria-label="Hora de vencimento"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            {/* Filtros e busca */}
                            <div className="p-5 border-b border-gray-700">
                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                                    <div className="filters-container">
                                        {[
                                            { label: "Todas", value: "all", icon: "fas fa-list" },
                                            { label: "Pendentes", value: "pending", icon: "fas fa-hourglass-half" },
                                            { label: "Hoje", value: "today", icon: "fas fa-calendar-day" },
                                            { label: "Atrasadas", value: "overdue", icon: "fas fa-exclamation-triangle" },
                                            { label: "", value: "completed", icon: "fas fa-check-circle" }
                                        ].map(({ label, value, icon }) => (
                                            <button
                                                key={value}
                                                onClick={() => setFilter(value)}
                                                disabled={isLoading}
                                                className={`flex items-center justify-center gap-1.5 px-3.5 py-1.5 rounded-lg font-medium smooth-transition text-sm whitespace-nowrap min-w-[4.5rem] ${
                                                    filter === value
                                                        ? "bg-gradient-to-r from-purple-600 to-purple-700 text-white"
                                                        : "bg-gray-800 text-gray-300 hover:bg-gray-700 border border-gray-700"
                                                } ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                title={value === "completed" ? "ConcluÃ­das" : label}
                                                aria-label={value === "completed" ? "Tarefas concluÃ­das" : `Filtrar por ${label.toLowerCase()}`}
                                            >
                                                <i className={icon} style={{fontSize: '0.85em'}}></i>
                                                <span>{label}</span>
                                            </button>
                                        ))}
                                    </div>

                                    <div className="flex gap-2 mt-3 md:mt-0">
                                        <div className="relative">
                                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                                <i className="fas fa-search"></i>
                                            </div>
                                            <input
                                                value={search}
                                                onChange={(e) => setSearch(e.target.value)}
                                                placeholder="Pesquisar tarefas..."
                                                className="pl-9 pr-3.5 py-1.5 w-full md:w-56 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent smooth-transition text-white placeholder-gray-500 text-sm"
                                                disabled={isLoading}
                                                aria-label="Pesquisar tarefas"
                                            />
                                        </div>

                                        <button
                                            onClick={clearCompleted}
                                            disabled={isLoading || !isConnected || stats.completed === 0}
                                            className="px-3 py-1.5 rounded-lg text-gray-300 hover:text-red-300 hover:bg-red-900/30 border border-red-700/50 smooth-transition flex items-center gap-1.5 text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                            aria-label="Limpar tarefas concluÃ­das"
                                        >
                                            <i className="fas fa-trash-alt" style={{fontSize: '0.85em'}}></i>
                                            <span className="hidden sm:inline">Limpar</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* Lista de tarefas */}
                            <main className="p-5">
                                {isLoading && tasks.length === 0 ? (
                                    <div className="text-center py-12">
                                        <div className="max-w-md mx-auto">
                                            <div className="text-5xl mb-3 text-purple-500">
                                                <i className="fas fa-spinner fa-spin"></i>
                                            </div>
                                            <h3 className="text-xl font-bold mb-1 text-gray-200">
                                                {isConnected ? "Carregando tarefas..." : "Sem conexÃ£o com a internet"}
                                            </h3>
                                            <p className="text-gray-400 text-sm">
                                                {isConnected ? "Conectando ao banco de dados..." : "Verifique sua conexÃ£o e tente novamente"}
                                            </p>
                                        </div>
                                    </div>
                                ) : visibleTasks.length === 0 ? (
                                    <div className="text-center py-12">
                                        {filter === "completed" ? (
                                            <div className="max-w-md mx-auto">
                                                <div className="text-5xl mb-3 text-green-400">
                                                    <i className="fas fa-check-circle"></i>
                                                </div>
                                                <h3 className="text-xl font-bold mb-1 text-green-300">
                                                    Tudo ConcluÃ­do!
                                                </h3>
                                                <p className="text-gray-400 text-sm">
                                                    Aiii! VocÃª estÃ¡ Ã  frente de suas tarefas. Adicione novos objetivos para continuar seu progresso.
                                                </p>
                                            </div>
                                        ) : (
                                            <div className="max-w-md mx-auto">
                                                <div className="text-5xl mb-3 text-purple-500">
                                                    <i className="fas fa-clipboard-list"></i>
                                                </div>
                                                <h3 className="text-xl font-bold mb-1 text-gray-200">
                                                    {search ? "Nenhuma tarefa encontrada" : "Nenhuma tarefa aqui"}
                                                </h3>
                                                <p className="text-gray-400 text-sm">
                                                    {search 
                                                        ? "Tente ajustar sua busca ou limpar o filtro."
                                                        : "Adicione sua primeira tarefa e comece a organizar seu dia!"}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="space-y-2.5">
                                        {visibleTasks.map((task, index) => (
                                            <TaskItem
                                                key={task.id}
                                                task={task}
                                                index={index}
                                                toggleDone={toggleDone}
                                                startEdit={startEdit}
                                                removeTask={removeTask}
                                                isLoading={isLoading}
                                                isConnected={isConnected}
                                                draggedTask={draggedTask}
                                                dragOverTask={dragOverTask}
                                                onDragStart={handleDragStart}
                                                onDragOver={handleDragOver}
                                                onDragLeave={handleDragLeave}
                                                onDrop={handleDrop}
                                                onDragEnd={handleDragEnd}
                                            />
                                        ))}
                                    </div>
                                )}
                            </main>

                            {/* RodapÃ© com progresso */}
                            <div className="p-5 bg-gray-900 border-t border-gray-700">
                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                    <div className="flex items-center gap-4">
                                        <div className="w-20 h-20 relative">
                                            <svg className="w-full h-full" viewBox="0 0 36 36">
                                                <circle
                                                    className="text-gray-700"
                                                    strokeWidth="2.5"
                                                    strokeDasharray="100"
                                                    strokeDashoffset="0"
                                                    fill="none"
                                                    cx="18"
                                                    cy="18"
                                                    r="16"
                                                />
                                                <circle
                                                    className="progress-ring text-purple-600"
                                                    strokeWidth="2.5"
                                                    strokeDasharray="100"
                                                    strokeDashoffset={`${100 - stats.completionRate}`}
                                                    fill="none"
                                                    cx="18"
                                                    cy="18"
                                                    r="16"
                                                />
                                                <text
                                                    x="18"
                                                    y="20"
                                                    className="text-gray-200 text-sm font-bold text-center fill-current"
                                                    textAnchor="middle"
                                                >
                                                    {stats.completionRate}%
                                                </text>
                                            </svg>
                                        </div>
                                        <div>
                                            <h3 className="text-base font-bold text-purple-400">
                                                {getCompletionText()}
                                            </h3>
                                            <p className="text-gray-400 text-xs">
                                                {stats.total > 0 
                                                    ? `VocÃª completou ${stats.completed} de ${stats.total} tarefas.`
                                                    : 'Adicione sua primeira tarefa para comeÃ§ar!'}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="text-center md:text-right">
                                        <p className="text-xs text-gray-400">
                                            <i className="far fa-clock mr-1.5 text-[0.8em]"></i>
                                            {lastSync ? `Ãšltima sincronizaÃ§Ã£o: ${lastSync.toLocaleTimeString('pt-BR')}` : 'Aguardando sincronizaÃ§Ã£o...'}
                                        </p>
                                        <p className="text-[0.75rem] text-gray-500 mt-0.5">
                                            <i className="fas fa-users mr-1 text-[0.7em]"></i>
                                            Tarefas sincronizadas em tempo real
                                        </p>
                                        <p className="text-[0.7rem] text-gray-600 mt-1">
                                            <i className="fas fa-arrows-alt mr-1 text-[0.65em]"></i>
                                            Arraste as tarefas para reordenar
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Modal de Gerenciamento de Frases */}
                        {showPhrasesModal && (
                            <div className="modal-overlay">
                                <div className="modal-content p-5">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-bold text-gray-200">Gerenciar Frases de Elogio</h3>
                                        <button 
                                            onClick={() => setShowPhrasesModal(false)}
                                            className="text-gray-400 hover:text-white smooth-transition p-1 rounded"
                                            aria-label="Fechar modal"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <div className="flex gap-2 mb-3">
                                            <input
                                                value={newPhrase}
                                                onChange={(e) => setNewPhrase(e.target.value)}
                                                placeholder="Adicionar nova frase..."
                                                className="flex-1 px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent text-white placeholder-gray-500 text-sm smooth-transition"
                                                onKeyPress={(e) => e.key === 'Enter' && addPhrase()}
                                                disabled={isLoading || !isConnected}
                                            />
                                            <button
                                                onClick={addPhrase}
                                                disabled={isLoading || !isConnected || !newPhrase.trim()}
                                                className="px-3 py-2 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-lg text-sm smooth-transition disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <div className="max-h-60 overflow-y-auto">
                                            {phrases.completionTexts.length === 0 ? (
                                                <p className="text-gray-400 text-sm text-center py-4">
                                                    Nenhuma frase adicionada ainda.
                                                </p>
                                            ) : (
                                                phrases.completionTexts.map((phrase, index) => (
                                                    <div key={index} className="flex items-center justify-between p-2 bg-gray-800 rounded-lg mb-2 smooth-transition hover:bg-gray-750">
                                                        <span className="text-gray-200 text-sm">{phrase}</span>
                                                        <button
                                                            onClick={() => removePhrase(index)}
                                                            disabled={isLoading || !isConnected}
                                                            className="text-red-400 hover:text-red-300 smooth-transition ml-2 p-1 rounded disabled:opacity-50"
                                                            aria-label={`Remover frase: ${phrase}`}
                                                        >
                                                            <i className="fas fa-trash-alt text-sm"></i>
                                                        </button>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div className="flex justify-between">
                                        <button
                                            onClick={resetPhrases}
                                            disabled={isLoading || !isConnected}
                                            className="px-3 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg text-sm smooth-transition disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Restaurar PadrÃ£o
                                        </button>
                                        <button
                                            onClick={() => setShowPhrasesModal(false)}
                                            className="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm smooth-transition"
                                        >
                                            Fechar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        <footer className="mt-5 text-center text-xs text-gray-600">
                            <p>
                                <i className="fas fa-code mr-1"></i>
                                Desenvolvido com â¤ï¸ By D3xt4rz | 
                                <i className="fas fa-database ml-2 mr-1"></i>
                                SincronizaÃ§Ã£o em tempo real com Firebase |
                                <i className="fas fa-arrows-alt ml-2 mr-1"></i>
                                Arraste para reordenar
                            </p>
                        </footer>
                    </div>
                </div>
            );
        }

        // Renderizar a aplicaÃ§Ã£o
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DailyTasksApp />);
    </script>
</body>
</html>
